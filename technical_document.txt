# Documentación Técnica - Tienda sin TACC

## Resumen
Este documento describe la arquitectura y lógica detrás del MVP de "Tienda sin TACC", una aplicación de e-commerce para productos orgánicos.

## Arquitectura

### Backend (Node.js + Express)
El servidor actúa como una API REST simple y un servidor de archivos estáticos.
- **Servidor Web**: Utilizamos `Express` para manejar las rutas HTTP.
- **Base de Datos en Memoria**: Para este MVP, los productos se almacenan en un array constante `products` en `server.js`. Esto evita la complejidad de configurar una base de datos real (como MongoDB o SQL) en esta etapa.
- **Integración Externa**: Se utiliza `axios` para realizar peticiones HTTP a la API de CallMeBot. Esto permite enviar notificaciones de WhatsApp sin necesidad de un SDK complejo de Meta.

### Frontend (Vanilla JS + HTML/CSS)
El frontend es una Single Page Application (SPA) simplificada que consume la API del backend.
- **Renderizado Dinámico**: `app.js` realiza una petición `fetch('/api/products')` al cargar la página y genera el HTML de los productos dinámicamente insertando elementos en el DOM.
- **Gestión de Estado (Carrito)**:
  - El carrito se mantiene en una variable global `cart`.
  - **Persistencia**: Se utiliza `localStorage` para guardar el carrito y un timestamp (`timestamp`).
  - **Lógica de Expiración**: Al cargar la página, se compara el timestamp guardado con la hora actual. Si han pasado más de 2 horas (`CART_EXPIRY_HOURS`), se borra el carrito del `localStorage`.

## Flujo de Datos

1.  **Carga de Productos**: Frontend -> GET `/api/products` -> Backend responde con JSON.
2.  **Agregar al Carrito**: Interacción local en el navegador. Actualiza `cart` y `localStorage`.
3.  **Checkout**:
    - El usuario hace clic en "Finalizar Compra".
    - Frontend envía POST `/api/order` con los ítems y el total.
    - Backend recibe el pedido, formatea un mensaje de texto.
    - Backend llama a `https://api.callmebot.com/...`.
    - Backend responde al Frontend con éxito.
    - Frontend limpia el carrito y notifica al usuario.

## Conceptos Clave
- **API REST**: Separación clara entre datos (Backend) y presentación (Frontend).
- **Asincronía**: Uso de `async/await` para manejar operaciones que toman tiempo (peticiones de red) sin bloquear el hilo principal.
- **Persistencia Local**: Uso de `localStorage` para mantener el estado del usuario entre recargas de página sin necesidad de sesiones de servidor o cookies complejas.

## Despliegue (Deployment)

### Compatibilidad con Render
- **Puerto Dinámico**: Se modificó `server.js` para usar `process.env.PORT`. Render (y otros servicios en la nube) asignan un puerto dinámico mediante esta variable de entorno. Si no existe, por defecto usa el 3000.
- **Git**: Se inicializó un repositorio local y se creó un `.gitignore` para excluir `node_modules` y archivos sensibles.

### Pasos para Desplegar
1. Crear un repositorio en GitHub.
2. Seguir las instrucciones para hacer "push" del código local.
3. Conectar el repositorio a Render.com como un "Web Service".
4. Render detectará automáticamente `npm install` y `npm start`.
