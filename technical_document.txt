# Documentación Técnica: Tienda Kosher

## 1. Visión General del Proyecto
Este documento describe la arquitectura técnica y el funcionamiento de la "Tienda Kosher", un MVP (Producto Mínimo Viable) de comercio electrónico diseñado para facilitar pedidos de productos certificados a través de WhatsApp.

## 2. Arquitectura del Sistema
El sistema utiliza una arquitectura monolítica simple basada en Node.js:
- **Backend (Servidor)**: Node.js con Express. Gestiona la API y sirve los archivos estáticos.
- **Frontend (Cliente)**: HTML5, CSS3 y JavaScript Vanilla (sin frameworks). Se ejecuta en el navegador del usuario.
- **Integración Externa**: API de CallMeBot para el envío de notificaciones de pedidos a WhatsApp.

## 3. Backend ("server.js")
El servidor es el núcleo de la aplicación y tiene tres responsabilidades principales:

### 3.1. Servidor Web
- Utiliza "express.static" para servir la carpeta "public/", entregando el frontend al navegador.
- Configurado para escuchar en el puerto definido por "process.env.PORT" o el 3000 por defecto.

### 3.2. API REST
- **"GET /api/products"**:
  - Retorna el catálogo de productos en formato JSON.
  - Actualmente, los datos residen en memoria (array "products") para simplicidad del MVP.
- **"POST /api/order"**:
  - Recibe el objeto del pedido "{ items, total }".
  - Valida que el carrito no esté vacío.
  - Formatea un mensaje de texto legible para WhatsApp.
  - Realiza una petición HTTP a la API de CallMeBot.

### 3.3. Seguridad y Configuración
- **Variables de Entorno**: Se utiliza la librería "dotenv" para gestionar credenciales.
- **Datos Sensibles**: "PHONE" (número de destino) y "API_KEY" (credencial de CallMeBot) se cargan desde el archivo ".env" y nunca se exponen en el código fuente.

## 4. Frontend ("public/")
La interfaz de usuario está construida con estándares web modernos pero sencillos.

### 4.1. Estructura de Archivos
- "index.html": Maquetado semántico con secciones para Hero, Productos y Carrito.
- "styles.css": Estilos personalizados, diseño responsivo (Mobile First) y paleta de colores temática.
- "app.js": Lógica de negocio del cliente.

### 4.2. Lógica de Aplicación ("app.js")
- **Gestión de Estado**: El carrito se mantiene en una variable global "cart" y se sincroniza con el DOM.
- **Persistencia (LocalStorage)**:
  - El carrito se guarda en el navegador del usuario bajo la clave "tienda_kosher_cart".
  - **Mecanismo de Expiración**: Se guarda un "timestamp" junto con el carrito. Al cargar, si han pasado más de 2 horas ("CART_EXPIRY_HOURS"), el carrito se borra automáticamente para asegurar la frescura del stock y la sesión.
- **Interacción con API**:
  - "fetchProducts()": Carga dinámica de productos al iniciar.
  - "checkoutBtn": Envía los datos al endpoint "/api/order".

## 5. Flujo de Datos
1. El usuario navega y agrega productos -> "app.js" actualiza "cart" y "localStorage".
2. El usuario hace clic en "Finalizar Compra" -> "app.js" envía POST a "/api/order".
3. El servidor recibe el pedido -> Construye mensaje -> Llama a CallMeBot.
4. El dueño de la tienda recibe un WhatsApp con el detalle -> El servidor responde "200 OK" al cliente.
5. El cliente muestra alerta de éxito y vacía el carrito.

## 6. Configuración Local
Para levantar el proyecto:
1. Instalar dependencias: "npm install".
2. Crear archivo ".env" con "PHONE" y "API_KEY".
3. Ejecutar "npm start".